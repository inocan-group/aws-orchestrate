<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Step Functions | aws-orchestrate</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon-32x32.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="aws-orchestrate">
    <meta name="application-name" content="aws-orchestrate">
    <meta name="apple-mobile-web-app-capable" content="true">
    
    <link rel="preload" href="/assets/css/0.styles.cac0f318.css" as="style"><link rel="preload" href="/assets/js/app.dbcc07c8.js" as="script"><link rel="preload" href="/assets/js/2.c89000a8.js" as="script"><link rel="preload" href="/assets/js/16.292e2a5a.js" as="script"><link rel="preload" href="/assets/js/3.6bce455b.js" as="script"><link rel="prefetch" href="/assets/js/10.f0674ebe.js"><link rel="prefetch" href="/assets/js/11.8feac376.js"><link rel="prefetch" href="/assets/js/12.a47346cb.js"><link rel="prefetch" href="/assets/js/13.b3a80dd1.js"><link rel="prefetch" href="/assets/js/14.f8913775.js"><link rel="prefetch" href="/assets/js/15.e9ce673a.js"><link rel="prefetch" href="/assets/js/17.553ca4d8.js"><link rel="prefetch" href="/assets/js/18.ad21fe4d.js"><link rel="prefetch" href="/assets/js/19.90d72170.js"><link rel="prefetch" href="/assets/js/4.097130a0.js"><link rel="prefetch" href="/assets/js/5.091175b3.js"><link rel="prefetch" href="/assets/js/6.46fa04c6.js"><link rel="prefetch" href="/assets/js/7.6f1f1caa.js"><link rel="prefetch" href="/assets/js/8.928d13f9.js"><link rel="prefetch" href="/assets/js/9.0c28e3aa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cac0f318.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">aws-orchestrate</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/wrapper.html" class="nav-link">
  Wrapper Fn
</a></div><div class="nav-item"><a href="/step-fns.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Step Functions
</a></div><div class="nav-item"><a href="/devops.html" class="nav-link">
  Serverless Devops
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/wrapper.html" class="nav-link">
  Wrapper Fn
</a></div><div class="nav-item"><a href="/step-fns.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Step Functions
</a></div><div class="nav-item"><a href="/devops.html" class="nav-link">
  Serverless Devops
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Step Functions</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/step-fns.html#introduction" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/step-fns.html#terminology" class="sidebar-link">Terminology</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/step-fns.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#state-machine" class="sidebar-link">State Machine</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#step-function" class="sidebar-link">Step Function</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#state-s" class="sidebar-link">State(s)</a></li></ul></li><li><a href="/step-fns.html#getting-started" class="sidebar-link">Getting Started</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/step-fns.html#options" class="sidebar-link">Options</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#basic-usage" class="sidebar-link">Basic Usage</a></li></ul></li><li><a href="/step-fns.html#building-blocks" class="sidebar-link">Building Blocks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/step-fns.html#_1-task" class="sidebar-link">1. Task</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#_2-choice" class="sidebar-link">2. Choice</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#_3-map-and-parallel" class="sidebar-link">3. Map and Parallel</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#_4-pass" class="sidebar-link">4. Pass</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#_5-succeed-and-fail" class="sidebar-link">5. Succeed and Fail</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#_6-wait" class="sidebar-link">6. Wait</a></li></ul></li><li><a href="/step-fns.html#wrapper-integration" class="sidebar-link">Wrapper Integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/step-fns.html#calling-into-a-step-function" class="sidebar-link">Calling into a Step Function</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#error-handling-in-lambda-s" class="sidebar-link">Error handling in Lambda's</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#secret-management" class="sidebar-link">Secret Management</a></li></ul></li><li><a href="/step-fns.html#utility-functions" class="sidebar-link">Utility Functions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/step-fns.html#choiceitem-fn" class="sidebar-link">ChoiceItem() fn</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#catch-fn" class="sidebar-link">Catch() fn</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#retry-fn" class="sidebar-link">Retry() fn</a></li></ul></li><li><a href="/step-fns.html#examples" class="sidebar-link">Examples</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/step-fns.html#defining-a-state-machine" class="sidebar-link">Defining A State Machine</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#defining-a-step-function" class="sidebar-link">Defining A Step Function</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#defining-a-state" class="sidebar-link">Defining A State</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#deploying-a-state-machine" class="sidebar-link">Deploying A State Machine</a></li><li class="sidebar-sub-header"><a href="/step-fns.html#inspecting-a-state-machine" class="sidebar-link">Inspecting a State Machine</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="step-functions"><a href="#step-functions" class="header-anchor">#</a> Step Functions</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>AWS offers their <a href="https://aws.amazon.com/step-functions/" target="_blank" rel="noopener noreferrer"><strong>Step Functions</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> as a means to create powerful orchestration of lambda functions through a proprietary UDL .</p> <p>We can write a definition of our desired <em>step function</em> that would be composed of multiple steps that would receive an state that can be manipulated (handled) by steps (as <code>Task Step</code>) <em>aka State Machine</em>.</p> <p>As we metioned earlier <em>step functions</em> definition is composed of <strong>States</strong>, and already mentioned one above (<strong>Task Step</strong>), which is the most common used state because it let us call an aws service as <em>AWS Lambda function</em>. There are others state types as conditional, map/parallel, and terminal states like <code>Fail</code> or <code>Success</code>.</p> <p>The intent of this <code>module</code> is to give users and strongly typed and friendly API that let define step functions with more <code>confidence</code> and integrate smoothly with other <code>aws-orchestrate</code> functionalities as passing, correlation id, ssm secrets, etc.</p> <h2 id="terminology"><a href="#terminology" class="header-anchor">#</a> Terminology</h2> <h3 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h3> <p>We will attempt to define key terms which will be reinforced in the API (and type system) to describe key constructs when writing step functions:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h3 id="state-machine"><a href="#state-machine" class="header-anchor">#</a> State Machine</h3> <p>Even though the service is called &quot;Step Functions&quot;, ultimately it a <strong>State Machine</strong> that you &quot;deploy&quot; to AWS and get a uniquely identifying ARN back to make reference to. There are two key parts of the &quot;meta-data&quot; which help define a State Machine:</p> <ol><li><code>name</code> - the name of your state machine, it should be unique for the given repo you're working on but there's no need to assure uniqueness across repos as this is what the ARN is for</li> <li><code>type</code> - historically there was only one type but more recently an EXPRESS type has been introduced and it's important to <a href="https://docs.aws.amazon.com/step-functions/latest/dg/concepts-standard-vs-express.html" target="_blank" rel="noopener noreferrer">know which <em>type</em> your state machine should use<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. In most cases, if you can use Express than you <em>should</em> use express.</li></ol> <p>The bulk of the <em>state</em> in the State Machine, however, is not in the meta data but in the <code>definition</code> property which we will refer to as a <strong>Step Function</strong> (see next section).</p> <h3 id="step-function"><a href="#step-function" class="header-anchor">#</a> Step Function</h3> <p>A <strong>Step Function</strong> is a definition of all possible states/steps which can be <em>moved into</em> in the state machine, along with instruction on how to move to the <em>next</em> state. A complex step function can indeed be quite complex and because the AWS State Definitions are in YAML, you get no typing support at design time. Furthermore, step functions require a &quot;full deploy&quot; to get new versions to AWS.</p> <p>This can lead to a sometimes tiresome loop of: &quot;making silly mistake, deploying, identifying new mistake, deploying, etc.&quot; The <strong>aws-orchestrate</strong> library dramatically helps reduce this loop by providing a <code>StepFunction</code> utility function which provides strong typing that ensures what you've <em>built</em> will <em>deploy</em>.</p> <p>There will be much more detail in the <a href="#examples">Examples</a> section but you might expect a Step Function to be defined something like this:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> StepFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;aws-orchestrate&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myStepFn <span class="token operator">=</span> <span class="token function">StepFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>HandlerFn<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>HandlerFn<span class="token punctuation">.</span>next<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>HandlerFn<span class="token punctuation">.</span>last<span class="token punctuation">,</span> <span class="token punctuation">{</span> timeout<span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="state-s"><a href="#state-s" class="header-anchor">#</a> State(s)</h3> <p>A state machine must have &quot;states&quot; but of course from a terminology standpoint we say that a <em>state</em> belongs to the <strong>Step Function</strong> and that this function is then formalized by being wrapped by a <strong>State Machine</strong>. Anyway ... semantics. Who has the time?</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>In the next section we'll review all of the &quot;kinds&quot; of states that you can use to compose a Step Function.</p> <h2 id="getting-started"><a href="#getting-started" class="header-anchor">#</a> Getting Started</h2> <h3 id="options"><a href="#options" class="header-anchor">#</a> Options</h3> <ol><li><p>CLI based on directory and default export</p> <ul><li><p>User creates StepFunction in <code>/src/state-machines</code> directory</p> <ul><li><p>File has single <em>default</em> export</p> <p><strong>my-state-machine.ts</strong></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">StateMachine</span><span class="token punctuation">(</span><span class="token string">&quot;EmailCampaign&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      stepFunction<span class="token operator">:</span> <span class="token function">StepFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>HandlerFn<span class="token punctuation">.</span>GetLeadsInfo<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>HandlerFn<span class="token punctuation">.</span>RequestExternalInfo<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token string">'$.users'</span><span class="token punctuation">,</span> mapOptions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span>
              s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>HandlerFn<span class="token punctuation">.</span>EmailNotification'<span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>HandlerFn<span class="token punctuation">.</span>PersistNotificationResults<span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>When step function CLI is executed, yaml config file will be named based on TS file</li></ul></li></ul></li></ul></li> <li><p>CLI based on AST detection</p> <ul><li>We will again suggest that people create a <code>/src/state-machines</code> directory</li> <li>But we will run an AST parser over all TS files in this directory and look for exports of type <code>IStateMachine</code></li> <li>CLI: <code>build-sm -o state-machines</code> will produce <code>.yaml</code> files for each state machine into the root directory or any directory stated with <code>-o</code> modifier.</li></ul></li> <li><p>file services to YAML built into StateMachine API</p></li> <li><p>Other?</p></li></ol> <h3 id="basic-usage"><a href="#basic-usage" class="header-anchor">#</a> Basic Usage</h3> <p>If you are using <code>aws-orchestrate</code> , you should have a <code>&lt;root&gt;/serverless-config/stepFunctions</code> directory in your project root. That is the place where we are going to declare all our state machines.</p> <h4 id="fluent-api-syntax"><a href="#fluent-api-syntax" class="header-anchor">#</a> Fluent API Syntax</h4> <p>In our app we are going to have times when we want to specify a collection of states or other unit of work. We are going to be able to specify them by concatenating a fn and calling other from the returned object.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> pState <span class="token operator">=</span> <span class="token function">Parallel</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span><span class="token function">addBranch</span><span class="token punctuation">(</span>b1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addBranch</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> cState <span class="token operator">=</span> <span class="token function">Choice</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span><span class="token function">stringEquals</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> stepFn1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stringEquals</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> stepFn2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="shorthand-syntax"><a href="#shorthand-syntax" class="header-anchor">#</a> Shorthand Syntax</h4> <p>If our requirements of our step function grows, let's say that we want to use complex states like map. Declaring all in fluent api syntax would make harder to mantain. We might want to use this order syntax.</p> <p><em>notifyAllUsers.ts</em></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Task<span class="token punctuation">,</span> Map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;aws-orchestrate&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> emailNotification <span class="token operator">=</span> <span class="token function">Task</span><span class="token punctuation">(</span><span class="token string">&quot;emailNotificationFn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> persistNotificationResults <span class="token operator">=</span> <span class="token function">Task</span><span class="token punctuation">(</span><span class="token string">&quot;persistNotificationResultsFn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> notifyAllUsers <span class="token operator">=</span> <span class="token function">Map</span><span class="token punctuation">(</span><span class="token string">&quot;$.users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span>emailNotification<span class="token punctuation">,</span> persistNotificationResults<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><em>myAwesomeWorkflow.ts</em></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> StateMachine<span class="token punctuation">,</span> StepFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;aws-orchestrate&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> notifyAllUsers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getLeadsInfo <span class="token operator">=</span> <span class="token function">Task</span><span class="token punctuation">(</span><span class="token string">&quot;getLeadsInfoFn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> getExternalInfo <span class="token operator">=</span> <span class="token function">Task</span><span class="token punctuation">(</span><span class="token string">&quot;getExternalInfoFn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> stepFunction <span class="token operator">=</span> <span class="token function">StepFunction</span><span class="token punctuation">(</span>getLeadsInfo<span class="token punctuation">,</span> getExternalInfo<span class="token punctuation">,</span> notifyAllUsers<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> emailCampaign <span class="token operator">=</span> <span class="token function">StateMachine</span><span class="token punctuation">(</span><span class="token string">&quot;myAwesomeWorkflow&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  stepFunction<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="building-blocks"><a href="#building-blocks" class="header-anchor">#</a> Building Blocks</h2> <p>In this section we'll review the most important <em>kinds</em> of <strong>state</strong> you can include in a step function. While there are a few others you can use, they are edge cases and are easily found using the Typescript-powered intelisense (more on this in the <a href="#examples">Examples</a> section).</p> <p>In Step Functions there are some important <em>patterns</em> / <em>capabilities</em> that are worth understanding up front. These include:</p> <h3 id="_1-task"><a href="#_1-task" class="header-anchor">#</a> <a href="https://docs.aws.amazon.com/step-functions/latest/dg/amazon-states-language-task-state.html" target="_blank" rel="noopener noreferrer"><strong>1. Task</strong> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>The &quot;task&quot; is the most important part of most state machines as this is where your Lambda functions are called and the state machine is manipulated (via the Lambda's compute). Without any tasks, a step function would get pretty dull very quickly.</p> <p>Configuring a task within <strong>aws-orchestrate</strong> involves using the <code>task()</code> function or defining by an object values. The only <em>required</em> parameter is the AWS <strong>ARN</strong> that uniquely identifies the function, however there is an optional second parameter for additional configuration.</p> <ul><li>State Definition:</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> tState <span class="token operator">=</span> <span class="token function">Task</span><span class="token punctuation">(</span><span class="token string">&quot;arn:xxxxxxxx&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> timeOutSeconds<span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> tState <span class="token operator">=</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;arn:xxxxxxxx&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> timeOutSeconds<span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>Extending an existing step function with fluent api syntax:</li></ul> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> myStepFunction <span class="token operator">=</span> <span class="token function">StepFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;arn:zzzzzz&quot;</span><span class="token punctuation">,</span>  timeOutSeconds<span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The difference between these two is the flexiblity and reusability that give you to define taks by state definition and then reuse in other part of your step function</p> <blockquote><p><strong>Note:</strong> there <em>are</em> more advanced patterns of calling into different AWS service integrations (such as SNS, SQS, etc.) <a href="https://docs.aws.amazon.com/step-functions/latest/dg/amazon-states-language-task-state.html" target="_blank" rel="noopener noreferrer">see docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> which utilize a different set of parameters than the standard set and you can not use them when building with the <code>task()</code> function. Over time we will add these individual items as their own part of the API (instead of overloading the <code>task()</code> function)</p></blockquote> <h3 id="_2-choice"><a href="#_2-choice" class="header-anchor">#</a> <a href="https://docs.aws.amazon.com/step-functions/latest/dg/amazon-states-language-choice-state.html" target="_blank" rel="noopener noreferrer"><strong>2. Choice</strong> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>This allows the step function to be challenged with any number of logical <em>choice items</em> where the first condition which matches will be picked and it's <em>sub</em> Step Function's state will be handed over the state management.</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>In addition to expressing a ordinal number of <em>choice items</em> which you are looking for a match on you may also include a &quot;default&quot; choice items which contains Step Function to run through (this is recommended as a best practice).</p> <p>Configuring a choice would look something like the following:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// condition A (This is valid because first state [task] is finalized)</span>
<span class="token keyword">const</span> searchDuckDuckGo <span class="token operator">=</span> <span class="token function">ChoiceItem</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  c<span class="token punctuation">.</span><span class="token function">stringEquals</span><span class="token punctuation">(</span><span class="token string">&quot;duck&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;searchDuckDuckGo&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;searchDuckDuckGo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// default condition (Not valid because first state is not finalized. This is mandatory)</span>
<span class="token keyword">const</span> searchGoogle <span class="token operator">=</span> <span class="token function">ChoiceItem</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;searchGoogle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// conditions can be pass in any order and the last param is the option hash</span>
<span class="token keyword">const</span> searchText <span class="token operator">=</span> <span class="token function">Choice</span><span class="token punctuation">(</span>searchDuckDuckGo<span class="token punctuation">,</span> searchGoogle<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Note: Take in mind that <code>choice</code> state is a terminal state, which means that no more states can be added after this one (invalid configuration) or extended if we are using the fluent API:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code>    <span class="token keyword">const</span> fooTask <span class="token operator">=</span> <span class="token function">Task</span><span class="token punctuation">(</span><span class="token string">&quot;fooTask&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> myStepFunction <span class="token operator">=</span> <span class="token function">StepFunction</span><span class="token punctuation">(</span><span class="token punctuation">[</span>searchText<span class="token punctuation">,</span> fooTask<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// this should throw ServerlessError `not-valid` configuration error</span>

    <span class="token function">StepFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">choice</span><span class="token punctuation">(</span><span class="token punctuation">[</span>choiceItem1<span class="token punctuation">,</span> choiceItem2<span class="token punctuation">,</span> defaultChoiceItem<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token comment">// &lt;-- this API would not be able to call it after used the `choice` method</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_3-map-and-parallel"><a href="#_3-map-and-parallel" class="header-anchor">#</a> 3. Map and Parallel</h3> <p>The <code>Map</code> and <code>Parallel</code> state types both start parallel execution pipelines but in slightly different ways:</p> <ul><li><p><a href="https://docs.aws.amazon.com/step-functions/latest/dg/amazon-states-language-map-state.html" target="_blank" rel="noopener noreferrer"><strong>Map</strong> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>A Map state is intended to execute over <em>the same</em> Step Function in parallel where each instance is given a different set of inputs to use (and therefore work is not duplicative). This is done by choosing an <em>iterable</em> property in the request/input to the Map state</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><ul><li>Fluent API:</li></ul> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> notifyAllUsers <span class="token operator">=</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  s
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token string">&quot;$.users&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;notifyAllUsers&quot;</span><span class="token punctuation">,</span> maxConcurrency<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;emailNotification&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;persistNotificationResults&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>State Definition:</li></ul> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> emailNotification <span class="token operator">=</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;arn:zzz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> persistNotificationResults <span class="token operator">=</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;arn:zzz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> notifyAllUsers <span class="token operator">=</span> <span class="token function">Map</span><span class="token punctuation">(</span><span class="token string">&quot;$.users&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;notifyAllUsers&quot;</span><span class="token punctuation">,</span> maxConcurrency<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span>emailNotification<span class="token punctuation">,</span> persistNotificationResults<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p><a href="https://docs.aws.amazon.com/step-functions/latest/dg/amazon-states-language-parallel-state.html" target="_blank" rel="noopener noreferrer"><strong>Parallel</strong> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>A <em>parallel</em> state is intended to execute over an ordinal number of step functions (presumably different ones) in parallel.</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><ul><li>Fluent API:</li></ul> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// We can define branches on the fly with fluent api syntax.</span>
<span class="token keyword">const</span> pFluent <span class="token operator">=</span> <span class="token function">Parallel</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span><span class="token function">addBranch</span><span class="token punctuation">(</span>sf1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addBranch</span><span class="token punctuation">(</span>sf2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>State Definition:</li></ul> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// We can define step functions that are going to be used as branches separately</span>
<span class="token keyword">const</span> branch1 <span class="token operator">=</span> <span class="token function">StepFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;foo1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> branch2 <span class="token operator">=</span> <span class="token function">StepFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;foo2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">StateMachine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span>branch1<span class="token punctuation">,</span> branch2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul> <h3 id="_4-pass"><a href="#_4-pass" class="header-anchor">#</a> <a href="https://docs.aws.amazon.com/step-functions/latest/dg/amazon-states-language-pass-state.html" target="_blank" rel="noopener noreferrer">4. Pass<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>After a first look, this state could not see useful because its only purpose is to receive an input and return and ouput. It also has the <a href="https://docs.aws.amazon.com/step-functions/latest/dg/amazon-states-language-common-fields.html" target="_blank" rel="noopener noreferrer">common types<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> fields and other ones that let us to modify the output or can be use to debug the current &quot;state&quot;.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">pass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> outputPath<span class="token operator">:</span> <span class="token string">&quot;$.foo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Pass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> outputPath<span class="token operator">:</span> <span class="token string">&quot;$.foo&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_5-succeed-and-fail"><a href="#_5-succeed-and-fail" class="header-anchor">#</a> <a href="https://docs.aws.amazon.com/step-functions/latest/dg/concepts-transitions.html" target="_blank" rel="noopener noreferrer">5. Succeed and Fail <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>These are terminal states, which means that our step function should end there. Non-terminal states can also be marked as terminal state explicitly, but, having <code>Succeed</code> or <code>Fail</code> states can help to be more expressive about the state of our state machine.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// Succeed</span>
<span class="token keyword">const</span> succeed1 <span class="token operator">=</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> succeed2 <span class="token operator">=</span> <span class="token function">Succeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Fail</span>
<span class="token keyword">const</span> fail1 <span class="token operator">=</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;error cause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fail2 <span class="token operator">=</span> <span class="token function">Fail</span><span class="token punctuation">(</span><span class="token string">&quot;error cause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_6-wait"><a href="#_6-wait" class="header-anchor">#</a> <a href="https://docs.aws.amazon.com/step-functions/latest/dg/amazon-states-language-wait-state.html" target="_blank" rel="noopener noreferrer">6. Wait <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Last but <em>possibly</em> not least is <code>Wait</code> ... thanks for waiting for it. All kidding aside, the Wait state is actually a very cool feature that Step Functions bring. In fact, sometimes it may be the sole reason you decided to step away from plain old Lambda execution. Why?</p> <p>In the world of Lambda you &quot;pay to wait&quot; but in Step Functions you can wait for free. For an Express Step Function that means up to 5 minutes but for a Standard Step Function you can wait up to a year!</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// First parameter is timeout as milliseconds</span>
<span class="token keyword">const</span> wState1 <span class="token operator">=</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> wState2 <span class="token operator">=</span> <span class="token function">Wait</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="wrapper-integration"><a href="#wrapper-integration" class="header-anchor">#</a> Wrapper Integration</h2> <p>If you're using <strong>aws-orchestrate</strong> we assume you're also using the included <code>wrapper()</code> function to gain strong typing on your Lambda handler functions. As you'll likely know too, this wrapper provides some useful features which would be a shame to miss out on simply because your Lambda function was called by AWS's Step Functions.</p> <h3 id="calling-into-a-step-function"><a href="#calling-into-a-step-function" class="header-anchor">#</a> Calling into a Step Function</h3> <p>If you are using <strong>aws-orchestrate</strong> lambda fn wrapper, it might be easy to start an state Machine execution just calling <code>invokeStepFn</code>. This would pass the context (correlationId, secrets, etc) we have in the current execution lambda fn to the new step Function executed. This would also improve the step function execution performance because if would not require to fetch those secrets again. And having correlationId is a key that would help us in traceability.</p> <h3 id="error-handling-in-lambda-s"><a href="#error-handling-in-lambda-s" class="header-anchor">#</a> Error handling in Lambda's</h3> <p>We should really be cautious about aws-orchestrate wrapper error handling in step function execution, because if we handle errors by ourselves we might override or hide the native Step Function Error Handling with states like (Catch and Retry). Other option is use error handling along step function error handler.</p> <h4 id="catch"><a href="#catch" class="header-anchor">#</a> Catch</h4> <p>This option state is available in most of our states. It enable us to determine what path to follow or if we want to terminate execution when an specific or all kind of error had thrown in one of our step function's state execution. If we have a state that contains other states like <code>map</code>, our scope would affect all children.</p> <ul><li>State Machine level:</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> myStateMachine <span class="token operator">=</span> <span class="token function">StateMachine</span><span class="token punctuation">(</span><span class="token string">&quot;myStateMachine&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  stepFunction<span class="token operator">:</span> myStepFn<span class="token punctuation">,</span>
  <span class="token function-variable function">catch</span><span class="token operator">:</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>NotifyError<span class="token punctuation">.</span>handlerFn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>Step function level:</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> fooStepFn <span class="token operator">=</span> <span class="token function">StepFunction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">catch</span><span class="token operator">:</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span><span class="token function">knownError</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>NotifyError<span class="token punctuation">.</span>handlerFn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;task1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>State level:</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> notifyError <span class="token operator">=</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>NotifyError<span class="token punctuation">.</span>handlerFn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> myStepFn <span class="token operator">=</span> <span class="token function">StepFunction</span><span class="token punctuation">(</span>notifyError<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fooTask <span class="token operator">=</span> <span class="token function">Task</span><span class="token punctuation">(</span><span class="token string">&quot;task1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">catch</span><span class="token operator">:</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>myStepFn<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="retry"><a href="#retry" class="header-anchor">#</a> Retry</h4> <p>This is also useful if we want to retry execution of error caught state. It is also important to keep in mind that execution the state again won't break our data flow.</p> <ul><li>example:</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> fooTask <span class="token operator">=</span> <span class="token function">State</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'fooTask'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token function-variable function">retry</span><span class="token operator">:</span> e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span><span class="token function">knownError</span><span class="token punctuation">(</span>retryOptions<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="secret-management"><a href="#secret-management" class="header-anchor">#</a> Secret Management</h3> <p>One of the benefits of using aws-orchestrate wrapper is that it detects secrets from input payload and include in our <code>request</code>, and if we fetched another ssm secret in the lambda fn handler, it would include along with the current one in the output/response, which is the input of the next state in our step function. All detection and includement in input/output is done under the hood.</p> <h2 id="utility-functions"><a href="#utility-functions" class="header-anchor">#</a> Utility Functions</h2> <p>In addition to the <code>StateMachine()</code>, <code>State()</code> and <code>StepFunction()</code> utilities you'll see in the <a href="#examples">examples</a> section, there are also some smaller grain utilities that will help you to achieve stronger typing:</p> <h3 id="choiceitem-fn"><a href="#choiceitem-fn" class="header-anchor">#</a> <code>ChoiceItem()</code> fn</h3> <p>It helps you to compose a condition to be used in &quot;choice&quot; state. Instead of having to type the operator property such as stringEquals, numberEquals by yourself, this method would let you to use fluent API to define the correct operator to be used.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> sendGreatNews <span class="token operator">=</span> <span class="token function">Task</span><span class="token punctuation">(</span><span class="token string">&quot;sendEmailNotification&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// You would be able to specify the state's property to be evaluated as the third parameter</span>
<span class="token keyword">const</span> myCondition <span class="token operator">=</span> <span class="token function">ChoiceItem</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span><span class="token function">numericEquals</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">&quot;$.score&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>sendGreatNews<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="catch-fn"><a href="#catch-fn" class="header-anchor">#</a> <code>Catch()</code> fn</h3> <p>States such as <code>task</code>, <code>parallel</code> and <code>map</code> have a way to catch errors and based on that continue to a certain state. It can be also possible to be used to pass along with a fallback state. errorHandler can also be defined at state machine or step function level.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// we have a util fn available from fluent API to build a sequence to the next state &quot;goTo()&quot;</span>
<span class="token keyword">const</span> openBrowser <span class="token operator">=</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;openBrowser&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;openBrowser&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> searchYahooTask <span class="token operator">=</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;searchYahoo&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;searchYahoo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Note that the last state shoulb be terminal or first state should be finalized to be a valid error handler</span>
<span class="token comment">// if not, it will throw an error when state machine are being built</span>
<span class="token keyword">const</span> myErrorHandler <span class="token operator">=</span> <span class="token function">Catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>NotifyError<span class="token punctuation">.</span>handlerFn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// state machine level</span>
<span class="token function">StateMachine</span><span class="token punctuation">(</span><span class="token string">&quot;fooStateMachine&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">catch</span><span class="token operator">:</span> myErrorHandler <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// step function level</span>
<span class="token function">StepFunction</span><span class="token punctuation">(</span>openBrowser<span class="token punctuation">,</span> searchYahooTask<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">catch</span><span class="token operator">:</span> myErrorHandler <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// state level</span>
<span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;fooTask&quot;</span><span class="token punctuation">,</span> <span class="token keyword">catch</span><span class="token operator">:</span> myErrorHandler <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="retry-fn"><a href="#retry-fn" class="header-anchor">#</a> <code>Retry()</code> fn</h3> <p>It uses a syntax like <code>errorHandler()</code> that was described above. The difference is that, instead of specifying the next state, you could just also determine some options about &quot;retry&quot; functionality. The re-execution of a state.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> retryHandler <span class="token operator">=</span> <span class="token function">Retry</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token punctuation">{</span> maxAttempts<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myFooTask <span class="token operator">=</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;myFooTask&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> retry<span class="token operator">:</span> retryHandler <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h2> <h3 id="defining-a-state-machine"><a href="#defining-a-state-machine" class="header-anchor">#</a> Defining A State Machine</h3> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> StepFunction<span class="token punctuation">,</span> StateMachine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'aws-orchestrate'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myStepFn <span class="token operator">=</span> <span class="token function">StepFunction</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>

<span class="token comment">// We pass the state machine name as the first parameter and its options in the second one</span>
<span class="token keyword">const</span> myStateMachine <span class="token operator">=</span> <span class="token function">StateMachine</span><span class="token punctuation">(</span><span class="token string">&quot;myAwesomeStateMachine&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> stepFn<span class="token operator">:</span> myStepFn <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> json <span class="token operator">=</span> myStateMachine<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> yaml <span class="token operator">=</span> myStateMachine<span class="token punctuation">.</span><span class="token function">toYaml</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="defining-a-step-function"><a href="#defining-a-step-function" class="header-anchor">#</a> Defining A Step Function</h3> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// fluent API</span>
<span class="token keyword">const</span> myStepFunction <span class="token operator">=</span> <span class="token function">StepFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;foo1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;foo2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// state definition</span>
<span class="token keyword">const</span> myStepFunction2 <span class="token operator">=</span> <span class="token function">StepFunction</span><span class="token punctuation">(</span>myState1<span class="token punctuation">,</span> myState2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;foo3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a step fn created with states can be extended by fluentAPI</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="defining-a-state"><a href="#defining-a-state" class="header-anchor">#</a> Defining A State</h3> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// In case of task state, the name property is generated as the lambda fn name associated with it</span>
<span class="token keyword">const</span> sendNotification <span class="token operator">=</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;sendNotification&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Other states the name is autogenerated as a hash of the state object definition</span>
<span class="token keyword">const</span> fooChoice <span class="token operator">=</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">choice</span><span class="token punctuation">(</span>choice1<span class="token punctuation">,</span> choice2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// fooChoice.name should be choice-[hash]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="deploying-a-state-machine"><a href="#deploying-a-state-machine" class="header-anchor">#</a> Deploying A State Machine</h3> <ul><li>Describe how the build process will convert to YAML.</li> <li>Point out automation from using <code>typescript-microservice</code> scaffold versus not</li></ul> <h3 id="inspecting-a-state-machine"><a href="#inspecting-a-state-machine" class="header-anchor">#</a> Inspecting a State Machine</h3> <ul><li>Describe how you can generate an SVG (or some visualization)</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/1/2021, 7:14:26 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.dbcc07c8.js" defer></script><script src="/assets/js/2.c89000a8.js" defer></script><script src="/assets/js/16.292e2a5a.js" defer></script><script src="/assets/js/3.6bce455b.js" defer></script>
  </body>
</html>
