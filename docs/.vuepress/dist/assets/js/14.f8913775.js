(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{399:function(e,t,s){"use strict";s.r(t);var a=s(21),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"serverless-devops"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#serverless-devops"}},[e._v("#")]),e._v(" Serverless Devops")]),e._v(" "),s("p",[s("strong",[e._v("NOTE:")]),e._v(" this functionality is still in pre-release. We sometimes lead with documentation first but please be aware that this has not yet been released into "),s("code",[e._v("aws-orchestrate")]),e._v('. Consider it "coming soon".')]),e._v(" "),s("h2",{attrs:{id:"overview"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),s("h3",{attrs:{id:"structure-and-genesis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#structure-and-genesis"}},[e._v("#")]),e._v(" Structure and Genesis")]),e._v(" "),s("p",[e._v("This framework's CLI surface area can be thought of in two parts:")]),e._v(" "),s("ol",[s("li",[s("p",[s("strong",[e._v("Wrapping Serverless CLI")])]),e._v(" "),s("p",[e._v("A big part of what we're doing is providing simple wrappers around the Serverless API to provide better defaults, a more composable configuration, and give you strong typing. We're not trying to compete with the existing CLI but rather enhance it.")])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("Additional Features")])]),e._v(" "),s("p",[e._v("There are some CLI commands that we've come up with beyond what already exists.")])])]),e._v(" "),s("p",[e._v("The genesis of the CLI is via the "),s("code",[e._v("do-devops")]),e._v(" repo. In fact the CLI is really "),s("em",[e._v("just")]),e._v(" the CLI which the "),s("code",[e._v("do-devops")]),e._v(" repo exposes, however, in this repo you will also find helpful utilities for making configuration even easier. Also, because both repos have the same basic authorship, "),s("code",[e._v("do-devops")]),e._v(" will recognize that you have the "),s("code",[e._v("aws-orchestrate")]),e._v(" repo installed and take on extra super powers as a result.")]),e._v(" "),s("p",[e._v("In this section we'll primarily talk about the "),s("em",[e._v("wrapping")]),e._v(" of the Serverless CLI and then hit the other features you get for free at the end.")]),e._v(" "),s("h3",{attrs:{id:"it-s-all-about-deployment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#it-s-all-about-deployment"}},[e._v("#")]),e._v(" It's all about Deployment")]),e._v(" "),s("p",[e._v("At the heart of the Serverless framework is the "),s("em",[e._v("central")]),e._v(" task of deployment. Aka, getting your functions, and other AWS resources/configuration up into the cloud so they can be run from there. This is the central problem that Serverless framework solved all those years ago and it's still the main utility that it provides.")]),e._v(" "),s("p",[e._v("When you deploy -- using the Serverless framework -- you might broadly be doing two things:")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# deploy all your services ")]),e._v("\nsls deploy\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# deploy just a function or a discrete set of functions")]),e._v("\nsls deploy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" --function helloWorld\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("blockquote",[s("p",[e._v("Serverless docs can be found here: "),s("a",{attrs:{href:"https://www.serverless.com/framework/docs/providers/aws/cli-reference/deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("deploy"),s("OutboundLink")],1),e._v(", "),s("a",{attrs:{href:"https://www.serverless.com/framework/docs/providers/aws/cli-reference/deploy-function/",target:"_blank",rel:"noopener noreferrer"}},[e._v("deploy function"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("Now hopefully, you'll have no surprises to find out that the "),s("code",[e._v("do-devops")]),e._v(" API surface is nearly the same:")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# deploy all your services ")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("dd")]),e._v(" deploy\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# deploy just a function or a discrete set of functions")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("dd")]),e._v(" deploy helloWorld\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("blockquote",[s("p",[e._v("all CLI commands are executed with "),s("code",[e._v("dd")]),e._v(" which can be installed globally or locally to the repo")])]),e._v(" "),s("p",[e._v("From an interaction standpoint, you'll see very little difference. There's a little less "),s("em",[e._v("cruft")]),e._v(" in deploying a function (or set of functions) but otherwise you interact in the same way. Behind the scenes, however, a lot more is happening but to understand that we'll need to get into greater details. For now let's just cover more topic in "),s("em",[e._v("overview mode")]),e._v(" and that is the "),s("code",[e._v("serverless.yml")]),e._v(" file.")]),e._v(" "),s("h3",{attrs:{id:"serverless-configuration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#serverless-configuration"}},[e._v("#")]),e._v(" Serverless Configuration")]),e._v(" "),s("p",[e._v("If you've used the "),s("a",{attrs:{href:"https://serverless.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("Serverless Framework"),s("OutboundLink")],1),e._v(" before you'll know that at the heart of this system is the "),s("code",[e._v("serverless.yml")]),e._v(" file. This file configures everything that eventually the framework will deploy to the cloud for you. When you switch to using the Serverless Devops wrappers you will instead focus your energy on the "),s("code",[e._v("serverless.ts")]),e._v(" file.")]),e._v(" "),s("p",[e._v("Moving from YAML to Typescript as the format for stating your configuration provides notable advantages:")]),e._v(" "),s("ul",[s("li",[e._v("Strong typing keeps you on safe guard rails; you can configure what you're allowed to configure but not what you aren't")]),e._v(" "),s("li",[e._v("With Typescript you'll get autocomplete and with typings that allow you to avoid having to refer to docs most of the time.")]),e._v(" "),s("li",[e._v("YAML is purely about configuration, Typescript can be used for this purpose but can also "),s("em",[e._v("react")]),e._v(" programatically to certain environmental or configured factors. This allows much more power when you need power.")])]),e._v(" "),s("p",[e._v("Ok we're done with the overview. Read on for more details of using the "),s("strong",[e._v("Serverless Devops")]),e._v(" framework.")]),e._v(" "),s("h2",{attrs:{id:"using-serverless-devops"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#using-serverless-devops"}},[e._v("#")]),e._v(" Using Serverless Devops")]),e._v(" "),s("h3",{attrs:{id:"convention-and-configuration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#convention-and-configuration"}},[e._v("#")]),e._v(" Convention and Configuration")]),e._v(" "),s("p",[e._v("People often talk about "),s("em",[e._v("convention over configuration")]),e._v(" and if you're a fan then we aim to please. But while aiming for "),s("em",[e._v("zero config")]),e._v(" is a nice idea its not truely practical. So once that bubble was burst for us we decided to aim at the following:")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Reduced Configuration through Convention")]),e._v(" "),s("p",[e._v("Whereever possible we will provide sensible defaults -- even resorting to magic where it still exists in this world -- to ensure you don't have to.")])]),e._v(" "),s("li",[s("p",[e._v("Strongly Typed Configuration")]),e._v(" "),s("p",[e._v("When configuration "),s("em",[e._v("is")]),e._v(" required, we want to have it be "),s("em",[e._v("strongly typed")]),e._v(' so that mistakes can be avoided and -- via comments and autocomplete -- some of the the documentation of configuration is "baked in".')])])]),e._v(" "),s("h3",{attrs:{id:"getting-started"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#getting-started"}},[e._v("#")]),e._v(" Getting Started")]),e._v(" "),s("p",[e._v("As was mentioned in the intro, we ask you to forget that pesky "),s("code",[e._v("serverless.yml")]),e._v(" file and focus instead on the "),s("code",[e._v("serverless.ts")]),e._v(" file (we'll automatically create the "),s("code",[e._v("serverless.yml")]),e._v(" file and you can always look over our shoulder).")]),e._v(" "),s("p",[e._v("So, what might your "),s("code",[e._v("serverless.ts")]),e._v(" file look like? Here's a very simple example:")]),e._v(" "),s("div",{staticClass:"language-ts line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" config"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" IServerlessConfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    service"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'my-cool-service'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    plugins"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'serverless-step-functions'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    provider"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" profile"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"cool"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("default")]),e._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br")])]),s("blockquote",[s("p",[e._v("Example "),s("code",[e._v("serverless.ts")]),e._v(" config file")])]),e._v(" "),s("p",[e._v("The first thing to note is that the top level "),s("em",[e._v("sections")]),e._v(" are the same as you'd have in the "),s("code",[e._v("serverless.yml")]),e._v(' file. Turns out we are fan\'s of the "wheel" '),s("em",[e._v("just as it is")]),e._v(". The hopefully obvious difference is that by typing it as "),s("code",[e._v("IServerlessConfig")]),e._v(", you get typing, autocomplete, and verbose inline comments on properties.")]),e._v(" "),s("h3",{attrs:{id:"sensible-defaults"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sensible-defaults"}},[e._v("#")]),e._v(" Sensible Defaults")]),e._v(" "),s("p",[e._v("Next you might be thinking -- considering how big "),s("code",[e._v("serverless.yml")]),e._v(" files can get -- that we're just being lazy and there's not a chance in hell this configuration could be it for a real project. But you'd be wrong.")]),e._v(" "),s("p",[e._v("The "),s("code",[e._v("aws-orchestrate")]),e._v(" framework aims to provide sensible defaults to keep your initial configuration needs very short. Examples of this include:")]),e._v(" "),s("ul",[s("li",[e._v('There is zero need to state "aws" for the '),s("code",[e._v("provider")]),e._v(" field which the Serverless Framework asks for because this framework only supports AWS.")]),e._v(" "),s("li",[e._v("You "),s("em",[e._v("might")]),e._v(" decide that you want to start developing for the 'prod' "),s("code",[e._v("stage")]),e._v(" but almost everyone wants the default stage to be 'dev' so we've just set that as the default. Want to roll the dice, go ahead and change it to whatever you like. Giddyup cowboy.")]),e._v(" "),s("li",[e._v("We "),s("em",[e._v("do")]),e._v(' require an AWS "profile" so that the build process can leverage the credentials stored in it when we deploy but because AWS profiles can optionally state a region, we will default the '),s("code",[e._v("region")]),e._v(" property to whatever your profile says it should be but if you didn't say in the config or credential file then it will default to "),s("code",[e._v("us-east-1")]),e._v(" and you'll be treated like the sheep you always wished your sweater was made with.")])]),e._v(" "),s("p",[e._v("If you don't trust magic (or for that matter "),s("em",[e._v("defaults")]),e._v(") you can always run "),s("code",[e._v("yarn sls_build")]),e._v(" and we'll build the "),s("code",[e._v("serverless.yml")]),e._v(" for you to gaze in wonderment in how much easier your life has gotten. You truely have arrived.")]),e._v(" "),s("h3",{attrs:{id:"inline-handler-configuration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#inline-handler-configuration"}},[e._v("#")]),e._v(" Inline Handler Configuration")]),e._v(" "),s("p",[e._v("This devops framework allows you to configure your handler functions in the same file that you define your function:")]),e._v(" "),s("p",[s("code",[e._v("src/foobar.ts")])]),e._v(" "),s("div",{staticClass:"language-ts line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("export")]),e._v(" config"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" IHandlerConfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    description"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"The foobar service brings foo and bar together"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    memorySize"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    events"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" httpApi"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"POST /foobar"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("export")]),e._v(" fn"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" IHandlerFunction"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("IRequest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" IResponse"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("async")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" handler "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("wrapper")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("fn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("p",[e._v("Now we'll let you get over your initial excitement that "),s("em",[e._v("foo")]),e._v(" and "),s("em",[e._v("bar")]),e._v(" have been finally brought together by the above handler but then let's dig into why this is better.")]),e._v(" "),s("p",[e._v("So as the example above alludes to:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("Handler Detection.")]),e._v(" You can now put your handler files anywhere in your "),s("code",[e._v("src")]),e._v(" directory and so long as you're exporting a symbol called "),s("code",[e._v("handler")]),e._v(" the build system will see this as a handler file and make sure it is included at build time into the "),s("code",[e._v("serverless.yml")]),e._v(" file.")]),e._v(" "),s("li",[s("strong",[e._v("Inline Handler Config.")]),e._v(" If you export a symbol called "),s("code",[e._v("config")]),e._v(" from this file, we'll use this to configure your lambda function as well")])]),e._v(" "),s("blockquote",[s("p",[s("strong",[e._v("Note:")]),e._v(" the "),s("strong",[e._v("name")]),e._v(" of your handler function will be derived from the "),s("em",[e._v("filename")]),e._v(" and if you do not export a "),s("code",[e._v("config")]),e._v(" symbol we'll just configure the handler with the name property.")])]),e._v(" "),s("p",[e._v("In contrast to the normal Serverless approach of writing the function and then going into the "),s("code",[e._v("serverless.yml")]),e._v(" file and and pointing back to the handler and configuring it along with everything else. In our experience, having the functions configuration "),s("em",[e._v("near")]),e._v(" the function itself is much nicer. It increases DX by reducing back-and-forth friction, encourages developers to consider config more (and hopefully at least add a description), and ensures that all your handlers make it into your next build because the build system is now responsible for that.")]),e._v(" "),s("h3",{attrs:{id:"a-safety-hatch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#a-safety-hatch"}},[e._v("#")]),e._v(" A Safety Hatch")]),e._v(" "),s("p",[e._v("These features are great but really only service Typescript Lambda functions and for that reason among others which we may remain unforseen for these humble library authors we need to be sure that there is a way to allow for you to work outside the system when you need to.")]),e._v(" "),s("p",[e._v("In order to accomodate your rouge ideas we look for a "),s("code",[e._v("/functions.ts")]),e._v(" file at "),s("em",[e._v("build time")]),e._v(" and if it exists and has a default export that is an array, we will use it "),s("em",[e._v("in addition")]),e._v(" to the auto-detected handler functions. An example might look like:")]),e._v(" "),s("div",{staticClass:"language-ts line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" rougeFunctions"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" IServerlessFunction"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" \n        handler"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'src/is-it-a-cat/cat-detector.handler'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        description"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'find cats in images using python ai lib'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        runtime"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'python3.6'")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("default")]),e._v(" rougeFunctions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("h2",{attrs:{id:"step-function-integration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step-function-integration"}},[e._v("#")]),e._v(" Step Function Integration")]),e._v(" "),s("p",[e._v("When you add the Serverless Framework's plugin for step functions you are telling the build system that you're wanting to use the AWS's step functions and the build system, in a manner similar to with Lambda functions, will look in your "),s("code",[e._v("/src")]),e._v(" folder for any step function definitions using the builder library that comes with this repo.")]),e._v(" "),s("p",[e._v("So, for instance, if you have a simple step function that represents a sequence of Lambda executions you might add a file "),s("code",[e._v("src/step-fns/mySequence.ts")]),e._v(" to your repo:")]),e._v(" "),s("div",{staticClass:"language-ts line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" StepFunction"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" StateMachine "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'aws-orchestrate'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" stepFn "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("StepFunction")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("task")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'one'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("task")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'two'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("task")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'three'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("default")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("StateMachine")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"mySequence"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" stepFn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("p",[s("strong",[e._v("TODO:")]),e._v(" finish after completing API")]),e._v(" "),s("p",[e._v("By exporting a "),s("em",[e._v("default export")]),e._v(" of , it will be detected by the build system. If you've already included the step-function plugin to your configuration then it will automatically added to the definition of your step function into")]),e._v(" "),s("h3",{attrs:{id:"auto-enumeration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#auto-enumeration"}},[e._v("#")]),e._v(" Auto Enumeration")]),e._v(" "),s("p",[e._v("Now that you hopefully are excited about the nicities of having your functions auto-detected and brought into the "),s("code",[e._v("serverless.yml")]),e._v(" automatically it's time for us to let you know there are a few more fringe benefits:")]),e._v(" "),s("ol",[s("li",[s("strong",[e._v("Function Enumeration")]),e._v(" - because we can detect your handler functions we can also provide you a typescript enumeration of")])]),e._v(" "),s("h2",{attrs:{id:"deployment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deployment"}},[e._v("#")]),e._v(" Deployment")]),e._v(" "),s("p",[e._v("Up to now we've talked about the build system as something which takes strongly typed configuration in "),s("code",[e._v("serverless.ts")]),e._v(" and converts to a fully compliant "),s("code",[e._v("serverless.yml")]),e._v(' file. This is what we refer to as the "build step" and it is a critical first step in getting your service up to the cloud, but '),s("em",[e._v("deploying")]),e._v(" code is another part of this build system. This means that instead of typing "),s("code",[e._v("sls deploy")]),e._v(" as you may be used to with the Serverless Framework we will ask you to instead switch to "),s("code",[e._v("yarn sls-deploy")]),e._v(" to get this system's wrapper.")]),e._v(" "),s("p",[e._v("In the end, we are still using the Serverless Framework's deployment CLI but we want the chance to prep the environment first as well as add some DX nicities. Below is the pipeline that will be kicked off when you run "),s("code",[e._v("yarn sls-deploy")]),e._v(":")]),e._v(" "),s("ul",[s("li",[e._v("Build's a fresh version of "),s("code",[e._v("serverless.yml")]),e._v(" from your config")]),e._v(" "),s("li",[e._v("Transpiles your TS to JS using Rollup (more on this below)")]),e._v(" "),s("li",[e._v("Calls Serverless Framework's deploy")])]),e._v(" "),s("h3",{attrs:{id:"full-deploys-and-per-function"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#full-deploys-and-per-function"}},[e._v("#")]),e._v(" Full Deploys and Per Function")]),e._v(" "),s("p",[e._v('The Serverless framework provides a "deploy" command that really has two distinct use-cases.')]),e._v(" "),s("ul",[s("li",[e._v("Deploy everything")]),e._v(" "),s("li",[e._v("Deploy 1 or more functions")])]),e._v(" "),s("p",[e._v("As we all find out soon enough that a full deploy is "),s("em",[e._v("necessary")]),e._v(" sometimes but function deploys are preferred in most cases as the cycle time is far shorter. There's nothing particular wrong with the API that the Serverless framework exposes but it feels a bit verbose. With the wrapper provided here you simply do one of the following:")]),e._v(" "),s("ol",[s("li",[s("code",[e._v("yarn deploy")]),e._v(" - will bring up an interactive menu which lets you choose a set of functions to deploy")]),e._v(" "),s("li",[s("code",[e._v("yarn deploy all")]),e._v(" - deploys everything")]),e._v(" "),s("li",[s("code",[e._v("yarn deploy fn1 [fn2 fn3]")]),e._v(" - deploys just the functions which")])]),e._v(" "),s("p",[e._v("Quietly -- in a rarely visited corner of the Internet -- a library author is congratulating themself for improving on what was already an entirely reasonable API. Hopefully you can join them in their happiness soon.")]),e._v(" "),s("p",[e._v("In all other regards we reflect the default API so if you want to state explicitly the "),s("em",[e._v("stage")]),e._v(" you use the same "),s("code",[e._v("--stage [stage]")]),e._v(" syntax. Same goes for "),s("em",[e._v("region")]),e._v(", etc.")]),e._v(" "),s("h3",{attrs:{id:"rollup-bundling"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rollup-bundling"}},[e._v("#")]),e._v(" Rollup Bundling")]),e._v(" "),s("p",[e._v("To keep your functions small and tree-shaken, the build system will ensure that all autodetected typescript handler functions are bundled using "),s("code",[e._v("Rollup")]),e._v(" to remove dead code. We find Rollup gets a smaller bundle sizes relative to the popular Webpack plugin approach. If, however, you've used the "),s("code",[e._v("serverless-webpack")]),e._v(" plugin before and are afraid of trying new things (yes that was a subtle dig) you can simply add the plugin to your configuration and we will not try and use Rollup for you. Just don't expect a Christmas card next year.")]),e._v(" "),s("p",[e._v("Assuming you're still on board with Rollup bundling, usage is fairly automatic but there are some subtlties for folks who like that sort of stuff.")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Closure Compiler.")]),e._v(" "),s("p",[e._v("By default we will run your code through the Closure Compiler. This makes the transpiled JS smaller and sometimes a bit more efficient when run with the V8 engine. If you don't want that you can either set the "),s("code",[e._v("CC")]),e._v(' environment variable to "off" or add '),s("code",[e._v("-cc off")]),e._v(" on the command line.")]),e._v(" "),s("p",[e._v("We typically recommend using the closure compiler for all "),s("em",[e._v("stages")]),e._v(" and this is what is done by default but you can also set the "),s("code",[e._v("CC")]),e._v(" variable to a stage name and so doing we will only use the closure compiler when the stage name is what you've set "),s("code",[e._v("CC")]),e._v(" to.")]),e._v(" "),s("p",[e._v("Finally, there are times -- not very often but not "),s("em",[e._v("never")]),e._v(" -- where an individual handler is not compatible with the closure compiler. In these cases, you can opt-out at the function level by stating "),s("code",[e._v("closure: false")]),e._v(" in the functions "),s("code",[e._v("IFunctionConfig")]),e._v(" configuration.")])]),e._v(" "),s("li",[s("p",[e._v("Conditional Transpilation.")]),e._v(" "),s("p",[e._v("When you run a "),s("em",[e._v("deploy")]),e._v(" we will make sure your handlers are transpiled but rather than blindly transpiling each function we will attempt to transpile only those which have changed since the last time you deployed. During the deployment you will be informed of which functions "),s("em",[e._v("are")]),e._v(" and "),s("em",[e._v("are not")]),e._v(" being transpiled. If based on this feedback or general suspicion of algorithms you want to ensure that all files are transpiled you can force this with the "),s("code",[e._v("--force")]),e._v(" switch on the command line.")])]),e._v(" "),s("li")])])}),[],!1,null,null,null);t.default=n.exports}}]);