(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{400:function(t,s,a){"use strict";a.r(s);var e=a(21),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"handler-wrapper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#handler-wrapper"}},[t._v("#")]),t._v(" Handler Wrapper")]),t._v(" "),a("p",[t._v("This library exports a function "),a("code",[t._v("wrapper")]),t._v(" which is intended to wrap all\nserverless handler functions. What it provides are the following:")]),t._v(" "),a("ul",[a("li",[t._v("strong "),a("strong",[t._v("type safety")]),t._v(" for your handler functions")]),t._v(" "),a("li",[t._v("a "),a("strong",[t._v("consistency")]),t._v(" abstraction to ensure your request parameters are always typed and where you expect them to be regardless of the caller")]),t._v(" "),a("li",[t._v("opinionated "),a("strong",[t._v("logging")]),t._v(" framework that ensures context while helping to block secrets slipping in")]),t._v(" "),a("li",[t._v("opinionated "),a("strong",[t._v("error handling")]),t._v(" which ensures that all errors are caught and appropriate handling can be put in place.")]),t._v(" "),a("li",[t._v("low friction ways to reach out to "),a("strong",[t._v("secrets")]),t._v(", lambda and step function "),a("strong",[t._v("invocation")]),t._v(", and XRay "),a("strong",[t._v("tracing")])])]),t._v(" "),a("h2",{attrs:{id:"usage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#usage"}},[t._v("#")]),t._v(" Usage")]),t._v(" "),a("p",[t._v("The basic usage pattern is to include the following in your serverless handler\nfile:")]),t._v(" "),a("div",{staticClass:"language-typescript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" wrapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" IHandlerFunction "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'aws-orchestrate'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" IHandlerFunction"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("IRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" IResponse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// your function goes here")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" handler "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wrapper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("This now provides a very similar signature for your function to work off but\nthree things are immediately improved:")]),t._v(" "),a("ul",[a("li",[t._v("All errors "),a("em",[t._v("will")]),t._v(" be handled and if you like you can take greater control of\nthat")]),t._v(" "),a("li",[t._v("The "),a("em",[t._v("request")]),t._v(" and "),a("em",[t._v("response")]),t._v(" data structures will automatically be passed to\nyou regardless of whether the function was called from another Lambda or from\nAWS Gateway.")]),t._v(" "),a("li",[t._v("The "),a("code",[t._v("context")]),t._v(" object has lots of new features that hang off of it (all the\nstandard ones are there too)")])]),t._v(" "),a("h2",{attrs:{id:"the-request"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-request"}},[t._v("#")]),t._v(" The Request")]),t._v(" "),a("p",[t._v('When you use AWS Lambda "out of the box" you will get an event/request object that will vary based on how it was called. In cases where your function is reponding to an API Gateway event you will typically get the '),a("strong",[t._v("Lambda Proxy Integration")]),t._v(" response. This gives you a whole host of name value pairs including the "),a("code",[t._v("body")]),t._v(" which is a string representation of the body of your request message. In contrast, when your function is called from another function the event object is the object notation which was sent out by the calling function.")]),t._v(" "),a("p",[t._v("This variance can be dealt with but it is noisy and introduces complexity in terms of getting a strongly typed input in the event object. This nuisance is made even more complicated by functions which can be called by "),a("em",[t._v("both")]),t._v(" the API Gateway and other functions.")]),t._v(" "),a("blockquote",[a("p",[t._v("Where possible, it is considered good practice for your handler functions to be neutral to the "),a("em",[t._v("caller")]),t._v(" of your function; this gives more utility/reuse.")])]),t._v(" "),a("p",[t._v("Fortunately, using the "),a("code",[t._v("wrapper")]),t._v(" function makes all of this VERY easy. The "),a("code",[t._v("request")]),t._v(" object passed into your handler function will ALLWAYS be a strongly typed message defined by the first "),a("em",[t._v("generic")]),t._v(" passed to the "),a("code",[t._v("IHandlerFunction")]),t._v(" type. Let's take a look at how this might look before using the wrapper:")]),t._v(" "),a("p",[a("strong",[t._v("regular handler:")])]),t._v(" "),a("div",{staticClass:"language-typescript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" handler"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" IAwsContext "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" IRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    request "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" IRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// this situation arrises when LambdaSequence functions are")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// calling one another")]),t._v("\n    request "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" IRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    request "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" IRequest\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// now we have a TYPED request object that we can rely on")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("p",[a("strong",[t._v("wrapper handler:")])]),t._v(" "),a("div",{staticClass:"language-typescript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" IHandlerFunction"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("IRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" IResponse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("context "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// immediately have a strongly typed request object")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" handler "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wrapper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("This expression of an "),a("em",[t._v("input")]),t._v(" and "),a("em",[t._v("output")]),t._v(" contract is a great way to start writing your function. Explain what it does and then describe precisely the data in and out. In most examples you'll only need this typing but if you want to go further you can also type the "),a("em",[t._v("query parameters")]),t._v(" and "),a("em",[t._v("path parameters")]),t._v(". The generics provided from "),a("code",[t._v("IHandlerFunction")]),t._v(" are:")]),t._v(" "),a("div",{staticClass:"language-ts line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IHandlerFunction"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("I")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("O")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Q")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("P")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("where "),a("code",[t._v("Q")]),t._v(" represents the query parameters, and "),a("code",[t._v("P")]),t._v(" the path parameters.")]),t._v(" "),a("h2",{attrs:{id:"enhanced-context"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#enhanced-context"}},[t._v("#")]),t._v(" Enhanced Context")]),t._v(" "),a("p",[t._v('If you\'re used to AWS Lambda functions you\'ll be used to having both the "event" and some additional\n"context" being provided via the API. By using the '),a("code",[t._v("wrapper")]),t._v(" function you still get the same two parameters but the "),a("em",[t._v("context")]),t._v(" will have a "),a("strong",[t._v("super set")]),t._v(" of what you get by default.")]),t._v(" "),a("p",[t._v("The wrapper object is fully typed (and therefore self-documenting) but here are some highlights:")]),t._v(" "),a("h3",{attrs:{id:"apis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apis"}},[t._v("#")]),t._v(" APIs")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("getSecrets()")]),t._v(" - integrates with AWS's "),a("code",[t._v("SSM")]),t._v(" to provide a secure and cost effective way of managing secrets")]),t._v(" "),a("li",[a("code",[t._v("errorMgmt")]),t._v(" - a simple API surface to manage error handling")]),t._v(" "),a("li",[a("code",[t._v("log")]),t._v(" - provides a logging API for you to use in place of dropping "),a("code",[t._v("console.log()")]),t._v(" statements throughout.")]),t._v(" "),a("li",[a("code",[t._v("invoke")]),t._v(" - asynchronously call another Lambda function from your handler")]),t._v(" "),a("li",[a("code",[t._v("invokeStepFn")]),t._v(" - asynchronously kick off a Step Function")])]),t._v(" "),a("blockquote",[a("p",[t._v("All of the above API's will be covered in later sections in greater detail")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("setSuccessCode")]),t._v(" - by default we'll return a status code of 200/204 based on whether there is content but you can override to whatever you like.")]),t._v(" "),a("li",[a("code",[t._v("setHeaders")]),t._v(" - when responding to API Gateway we will take care of most headers for you but you can add to those we've set for CORS, Content-Type, etc.")]),t._v(" "),a("li",[a("code",[t._v("setContentType")]),t._v(" - we default to "),a("em",[t._v("application/json")]),t._v(" as the response format but you can change this as you see fit.")])]),t._v(" "),a("h3",{attrs:{id:"additional-props"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#additional-props"}},[t._v("#")]),t._v(" Additional Props")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("headers")]),t._v(" - the headers made in the request (if there were headers)")]),t._v(" "),a("li",[a("code",[t._v("isApiGateway")]),t._v(" - a boolean flag to identify if the caller was API Gateway")]),t._v(" "),a("li",[a("code",[t._v("apiGateway")]),t._v(" the API Gateway dictionary (with the body removed to dedup); this and several other props is only available when the caller is API Gateway")]),t._v(" "),a("li",[a("code",[t._v("token")]),t._v(" - if a value was passed in in the "),a("code",[t._v("Authorization")]),t._v(" header has a value it will be placed here")]),t._v(" "),a("li",[a("code",[t._v("verb")]),t._v(" - the RESTful verb used in an API Gateway call")]),t._v(" "),a("li",[a("code",[t._v("queryParameter")]),t._v(" - strongly typed dictionary of query parameters")]),t._v(" "),a("li",[a("code",[t._v("pathParameters")]),t._v(" - strongly typed dictionary of path parameters")])]),t._v(" "),a("h2",{attrs:{id:"typed-returns"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#typed-returns"}},[t._v("#")]),t._v(" Typed Returns")]),t._v(" "),a("p",[t._v("Unlike traditional Lambda functions, with the wrapper function your return types will be strongly typed. That means that if you state your return type to be:")]),t._v(" "),a("div",{staticClass:"language-typescript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IResponse")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  foo"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  bar"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("This will be enforced by Typescript when you return from your function. What about when you're returning to a API Gateway caller? No problem, there is zero difference, you just return the body and the "),a("code",[t._v("wrapper")]),t._v(" function will ensure that the message will be prepared in an appropriate manner for API Gateway.")]),t._v(" "),a("p",[t._v("So imagine that you have an API Gateway caller then you would return like this:")]),t._v(" "),a("div",{staticClass:"language-typescript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" IHandlerFunction"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" IResponse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    foo"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello world'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    bar"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("and this would in turn respond to API Gateway with:")]),t._v(" "),a("div",{staticClass:"language-typescript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  statusCode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-Correlation-Id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1234dkjgdfg"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Origin"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Credentials"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{ "foo": "hello world", "bar": 1 }\'')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[t._v("As you can see, without doing anything it returns a valid API Gateway response which also includes CORS headers and the "),a("code",[t._v("correlationId")]),t._v(" for the function/sequence, and an appropriate "),a("strong",[t._v("Content-Type")]),t._v(" value.")]),t._v(" "),a("blockquote",[a("p",[t._v("There is no need to tell the "),a("code",[t._v("wrapper")]),t._v(" function whether the handler has been called by API Gateway or not; it will detect this for you.")])]),t._v(" "),a("h2",{attrs:{id:"logging"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logging"}},[t._v("#")]),t._v(" Logging")]),t._v(" "),a("p",[t._v("The context object passed into handler function has a "),a("code",[t._v("log")]),t._v(" property on it which give you access to a logging API provided by "),a("a",{attrs:{href:"https://github.com/inocan-group/aws-log",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("aws-log")]),a("OutboundLink")],1),t._v(":")]),t._v(" "),a("div",{staticClass:"language-typescript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" log "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nlog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'this is my message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" foo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bar "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("This logger should be used over "),a("code",[t._v("console.log")]),t._v(" in 100% of cases. Not only does it ensure your logs are properly structured in JSON format (important for log monitoring solutions) but it also:")]),t._v(" "),a("ul",[a("li",[t._v('Ensures that any "secrets" are masked before they accidentally bleed into the logs. You '),a("em",[t._v("can")]),t._v(' manually mask values but all "secrets" brough in via the getSecrets() API surface are automatically masked for you.')]),t._v(" "),a("li",[t._v("Contextual information from the Lambda environment is automatically added to your log messages to give a richer information ecosystem to your logs")]),t._v(" "),a("li",[t._v("You can specify, on a "),a("em",[t._v("per stage")]),t._v(" basis, which log levels are written to "),a("strong",[t._v("stdout")]),t._v('. This flexibility includes "sampling" certain log levels so you can maintain rich information in production without overwhelming storage limits.')])]),t._v(" "),a("p",[t._v('In order to configure the logging levels you want per stage, you will do this on the wrapper\'s "option hash". So for instance:')]),t._v(" "),a("div",{staticClass:"language-ts line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" handler "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wrapper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" logging"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n  debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"none"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" info"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" warn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("Here we've stated which "),a("em",[t._v("levels")]),t._v(" of severity we want to publish and in this case we're being consistent for all development stages. Being this uniform is rarely what you want and as we'll see the options are not just "),a("em",[t._v("all")]),t._v(" or "),a("em",[t._v("none")]),t._v(".")]),t._v(" "),a("h3",{attrs:{id:"logging-by-stage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logging-by-stage"}},[t._v("#")]),t._v(" Logging by Stage")]),t._v(" "),a("p",[t._v("This is the most common thing to see in configuration. Typically you'll want all of your logs in development stages but in production, where volumes are much heavier, tracking everything will have a real world cost to them.")]),t._v(" "),a("h3",{attrs:{id:"sampling-and-sampling-rates"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sampling-and-sampling-rates"}},[t._v("#")]),t._v(" Sampling and Sampling Rates")]),t._v(" "),a("p",[t._v("Beyond specifying "),a("em",[t._v("per stage")]),t._v(" what your configuration is, we can state that we'd like a random percentage of logs logged. This is very handy in production where we might be tempted to turn off something like the "),a("em",[t._v("debug")]),t._v(" level but in doing so we miss out on some of the richness in what is in fact our most important environment.")]),t._v(" "),a("h3",{attrs:{id:"a-more-advanced-example"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#a-more-advanced-example"}},[t._v("#")]),t._v(" A More Advanced Example")]),t._v(" "),a("p",[t._v("In the following example we'll see both "),a("em",[t._v("stage")]),t._v(" based configuration as well as sampling:")]),t._v(" "),a("div",{staticClass:"language-ts line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" dev "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" info"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" warn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" prod "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n  debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sample-by-session"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  info"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  warn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  error"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  sampleRate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".25")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" handler "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wrapper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" logging"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prod "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[t._v("Here you'll see that we've got different configurations for the "),a("code",[t._v("dev")]),t._v(" and "),a("code",[t._v("prod")]),t._v(" stages but in production we're only taking 25% of the logs at the "),a("strong",[t._v("debug")]),t._v(" severity level. That's it for now but the API is fully typed and self-documented and you can also refer to the "),a("code",[t._v("aws-log")]),t._v(" README for details as well.")]),t._v(" "),a("h3",{attrs:{id:"global-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#global-configuration"}},[t._v("#")]),t._v(" Global Configuration")]),t._v(" "),a("p",[t._v("When it comes to configuring logging, we've shown how this can be done using the wrapper function's\n"),a("em",[t._v("options hash")]),t._v(" and this approach works and gives fine-grained control at the handler function level. Sometimes this is exactly what is wanted but often we want to choose a logging configuration\nacross "),a("em",[t._v("all")]),t._v(" functions and while you can certainly do that with this approach it could get cumbersome. To address this, the logging feature will look for and ENV variable called "),a("code",[t._v("LOG_CONFIG")]),t._v(" and if found it will use this if no function-specific config is found.")]),t._v(" "),a("p",[t._v("Environment variables must always be "),a("em",[t._v("strings")]),t._v(" but to provide consistency in capability and structure from the programatic configuration we simple ask you put in a JSON stringified object. If you have a "),a("code",[t._v("env.yml")]),t._v(" config you might put something like:")]),t._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("&all_stages")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("LOG_CONFIG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{ "debug": "all", "info": "all", warn: "all", error: "all" }\'')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prod")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("<<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*all_stages")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("LOG_CONFIG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{ "debug": "sample-by-session", "info": "all", warn: "all", error: "all" }\'')]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("and if you choose to use the devops system that's part of this repo you can do the same in a "),a("code",[t._v("env.ts")]),t._v(" file but with strong typing and autocomplete:")]),t._v(" "),a("div",{staticClass:"language-ts line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Env "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aws-orchestrate"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("LOG_CONFIG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" info"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" warn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("prod")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("LOG_CONFIG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sample-by-session"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" info"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" warn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("h2",{attrs:{id:"secret-management"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#secret-management"}},[t._v("#")]),t._v(" Secret Management")]),t._v(" "),a("p",[t._v('It is all too common that "secrets" are stored in ENV variables and/or other sub-optimal solutions. This often leads to unintentional leaks, whether it be a larger audience viewing the variables than would be ideal or as we\'ve seen too many times the accidental commit of ENV variables to a repo.')]),t._v(" "),a("p",[t._v("This sub-optimal secret management is in large part due to the friction (and/or cost) of a more robust solution but fortunately AWS has a cost effect solution in "),a("a",{attrs:{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/parameter-store-about-examples.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("SSM Parameter Store"),a("OutboundLink")],1),t._v(". With the "),a("code",[t._v("wrapper")]),t._v(" function our aim is to reduce the friction of use as much as possible.")]),t._v(" "),a("p",[t._v("First off you can access secrets in your handler functions with the use of the "),a("code",[t._v("getSecrets()")]),t._v(' API surface. It allows you to state which "modules" of secrets you need. For instance, imagine that you want secrets relating to '),a("strong",[t._v("Firebase")]),t._v(" and "),a("strong",[t._v("Sendgrid")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-typescript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" IHandlerFunction"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("IRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" IResponse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("context "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" secrets "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSecrets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'supabase'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sendGrid'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("With this one line of code you are able to get all secrets associated with "),a("code",[t._v("supabase")]),t._v(" and "),a("code",[t._v("sendGrid")]),t._v('. Further, these secrets are isolated to the "stage" that you are at. This ensures that your '),a("em",[t._v("development")]),t._v(" functions will go against your "),a("em",[t._v("development")]),t._v(" Firebase database rather than staging, production, etc.")]),t._v(" "),a("blockquote",[a("p",[t._v("Note: we use the "),a("a",{attrs:{href:"https://github.com/inocan-group/aws-ssm",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("aws-ssm")]),a("OutboundLink")],1),t._v(" repo as a minor abstraction to both adhere to a opinioned convention around naming but also because we prefer the API surface than AWS's.")])]),t._v(" "),a("h2",{attrs:{id:"error-handling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#error-handling"}},[t._v("#")]),t._v(" Error Handling")]),t._v(" "),a("p",[t._v("All errors encountered in your handler function will be trapped by the "),a("code",[t._v("wrapper")]),t._v(" function and will report the error in a reasonable way without any configuration. If, however, you want to take a more active role than you can by leveraging one of two distinct mechanisms:")]),t._v(" "),a("ol",[a("li",[t._v("the Error Management API at "),a("code",[t._v("context.errorMgmt")])]),t._v(" "),a("li",[t._v("use or extend the "),a("code",[t._v("ServerlessError")]),t._v(" class exposed by this library")])]),t._v(" "),a("p",[t._v("In general, there are three error types you will get when using the wrapper function:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("ServerlessError")]),t._v(" - an explicitly thrown error which includes an HTTP status to handle the needs of all callers. This is the primary tool you'll use to throw errors you want to trap and the wrapper function uses this too for it's errors.")]),t._v(" "),a("li",[a("code",[t._v("KnownError")]),t._v(" - you can use the error management API to define certain error conditions you may encounter and what to do with them. In these cases the errors will be wrapped up as "),a("code",[t._v("KnownError")]),t._v("s.")]),t._v(" "),a("li",[a("code",[t._v("UnknownError")]),t._v(" - errors sometime occur unexpectedly and if aren't expressly throwing a "),a("strong",[t._v("ServerlessError")]),t._v(" or using the error API to setup for "),a("strong",[t._v("KnownErrors")]),t._v(" the remaining errors will be cast as "),a("strong",[t._v("UnknownErrors")]),t._v(".")])]),t._v(" "),a("h3",{attrs:{id:"serverlesserrors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#serverlesserrors"}},[t._v("#")]),t._v(" ServerlessErrors")]),t._v(" "),a("p",[t._v("As has been discussed, the ServerlessError is available to you as the author of handler functions. It's signature is as follows:")]),t._v(" "),a("div",{staticClass:"language-typescript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ServerlessError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"your message"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'type/subtype'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("The first parameter represents the HTTP error status code. The message is the message. And finally you're asked to provide a type/subtype classification of the error.")]),t._v(" "),a("blockquote",[a("p",[t._v("Note: if you want to wrap an "),a("em",[t._v("underlying")]),t._v(" error you can do so by assigning it to the "),a("code",[t._v("underlyingError")]),t._v(" property of the ServerlessError.")])]),t._v(" "),a("p",[t._v("For most people, use of the "),a("code",[t._v("ServerlessError")]),t._v(" provides a straightforward means of throwing errors which will be seen by the wrapper as intentional error which do not need error handling applied. As hopefully is already clear, you need not "),a("em",[t._v("catch")]),t._v(" your ServerlessErrors as the wrapper will do this and ensure that it is logged and then handled appropriately for the specific caller.")]),t._v(" "),a("h3",{attrs:{id:"error-management-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#error-management-api"}},[t._v("#")]),t._v(" Error Management API")]),t._v(" "),a("p",[t._v("The "),a("code",[t._v("errorMgmt")]),t._v(" property on the "),a("strong",[t._v("context")]),t._v(" object provides you an openning to do more advanced things in error management. The first of which is defining "),a("em",[t._v("known errors")]),t._v(" and expressing how they should be handled.")]),t._v(" "),a("p",[t._v("As an example, have a look at the following expression:")]),t._v(" "),a("div",{staticClass:"language-typescript line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" IHandlerFunction"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("IRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" IResponse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("errorMgmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" messageContains"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"not allowed"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v('This states that any error thrown which contains "not allowed" in the message should be set to the HTTP status code of 403. Because it is now '),a("em",[t._v("known")]),t._v(" when this pattern presents it will be wrapped as a "),a("code",[t._v("KnownError")]),t._v(".")]),t._v(" "),a("p",[t._v("Beyond simply changing the HTTP code, you can also take two other actions:")]),t._v(" "),a("ol",[a("li",[t._v('Add a callback "handler"')]),t._v(" "),a("li",[t._v("Forward the error to another Lambda")])]),t._v(" "),a("p",[t._v("In the case of a callback, you are given an asynchronous callback to do what you need "),a("em",[t._v("in process")]),t._v(" either to create a useful side effect like sending an email, etc. or you can actually attempt to "),a("em",[t._v("fix")]),t._v(" the problem. The callback's return type is "),a("code",[t._v("false")]),t._v(' for "did not fix" and otherwise expects you to meet the response typing contract that you\'re operating under.')]),t._v(" "),a("h3",{attrs:{id:"unknown-errors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unknown-errors"}},[t._v("#")]),t._v(" Unknown Errors")]),t._v(" "),a("p",[t._v("Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.")])])}),[],!1,null,null,null);s.default=n.exports}}]);